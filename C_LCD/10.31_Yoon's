//1031_CLCD
#include <iom128v.h>
void write_data(char d);
void write_instruction(char i); //위치값
void lcd_init(void);

void NumbertoTwoDigit(int a); //숫자값을 두개의 digit로 변환하는 함수
void NumbertoFourDigit(int a); //숫자값을 4자리로 변환해주는 함수
void write_string(char *pt); //문자열을 띄울수 있음 포인터를 사용해야함.
void NumbertoHex(char a); //문자열을 hex값으로 변환, 255(ff)까지 (0x00~ff)
void NumbertoBinary(char a); //이진수로 표현 0000 0000
char Hex_convert(char a); //숫자를 hex로 바꿀때 변환시키는 함수 12 => 0C
void delay_m(unsigned int m);
char dummy_1000, dummy_100, dummy_10, dummy_1;
unsigned int cnt = 0; //0~255
char sec;

int main(void){
    DDRG = 0x07; // 0000 0111 G2 G1 G0
    DDRC = 0xff; // 1111 1111
    lcd_init(); //
    while(1)
    {
        write_instruction(0x80);
        write_string("sec = ");
        cnt++;
        NumbertoTwoDigit(cnt);
        write_data(' ');
        NumbertoFourDigit(cnt);

        sec++;
        write_instruction(0xc0);
        NumbertoBinary(sec);
        write_data(' ');
        NumbertoHex(sec);
        delay_m(100);
        if(sec>9999){
            sec = 0;
        }
    }
}

void write_data(char d){
    PORTG = 0x06;
    delay_m(1);
    PORTC = d;
    delay_m(1);
    PORTG = 0x04;
}

void write_instruction(char i){
    PORTG = 0x02;
    delay_m(1);
    PORTC = i;
    delay_m(1);
    PORTG = 0x00;
}

void lcd_init(void){
    write_instruction(0x30);
    delay_m(15);
    write_instruction(0x30);
    delay_m(1);
    write_instruction(0x30);
    delay_m(1);
    write_instruction(0x30);
    delay_m(1);
    write_instruction(0x38);
    delay_m(1);
    write_instruction(0x0e);
    delay_m(1);
    write_instruction(0x01);
    delay_m(1);
}

void NumbertoTwoDigit(int a){

    char dummy_10;
    char dummy_1;

    dummy_10 = a / 100;
    a = (a - dummy_10 * 100);

    dummy_10 = a / 10;
    dummy_1 = (a - dummy_10 * 10) / 1 ;

    if(dummy_10 == 0){
        write_data(' ');
    }
    else {
        write_data(dummy_10 + 0x30);
    }
    write_data(dummy_1 + 0x30);
}

void NumbertoFourDigit(int a){

    dummy_1000 = a / 1000;
    dummy_100 = (a - dummy_1000 * 1000) / 100;
    dummy_10 = (a - dummy_1000 * 1000 - dummy_100 * 100) / 10;
    dummy_1 = (a - dummy_1000 * 1000 - dummy_100 * 100 - dummy_10 * 10) / 1;

    if(dummy_1000 == 0){
        write_data(' ');
    }
    else {
        write_data(dummy_1000 + 0x30);
    }

    if((dummy_100 == 0) && (a < 100)){
        write_data(' ');
    }
    else {
        write_data(dummy_100 + 0x30);
    }

    if((dummy_10 == 0) && (a < 10)) {
        write_data(' ');
    }
    else {
        write_data(dummy_10 + 0x30);
    }

    write_data(dummy_1 + 0x30);
}

void write_string(char *pt){ //string으로 아스키 문자열을 출력 가능

    while((*pt >= ' ') && (*pt <= '~')){  //포인터 pt가 0x20보다 크거나 같거나 0x7f보다 작거나 같은 조건을 모두 만족하면 (*pt >= 0x20) && (*pt <= 0x7e)
        write_data(*pt); //포인터 pt를 출력함
        *pt++; //작성한 pt를 증가시킴
    }
}

void NumbertoHex(char a){
    char hex_value[4] = {'0','x','0','0'};

    hex_value[2] = a / 16;
    hex_value[3] = a - hex_value[2]*16;

    write_data(hex_value[0]);
    write_data(hex_value[1]);
    write_data(Hex_convert(hex_value[2]));
    write_data(Hex_convert(hex_value[3]));
}

void NumbertoBinary(char a){

    char bin_value[8] = {'0','0','0','0','0','0','0','0'};

    bin_value[0] = a / 128;
    bin_value[1] = (a - bin_value[0]*128) / 64;
    bin_value[2] = (a - bin_value[0]*128 - bin_value[1]*64) / 32;
    bin_value[3] = (a - bin_value[0]*128 - bin_value[1]*64 - bin_value[2]*32) / 16;
    bin_value[4] = (a - bin_value[0]*128 - bin_value[1]*64 - bin_value[2]*32 - bin_value[3]*16) / 8;
    bin_value[5] = (a - bin_value[0]*128 - bin_value[1]*64 - bin_value[2]*32 - bin_value[3]*16 - bin_value[4]*8) / 4;
    bin_value[6] = (a - bin_value[0]*128 - bin_value[1]*64 - bin_value[2]*32 - bin_value[3]*16 - bin_value[4]*8 - bin_value[5]*4) / 2;
    bin_value[7] = (a - bin_value[0]*128 - bin_value[1]*64 - bin_value[2]*32 - bin_value[3]*16 - bin_value[4]*8 - bin_value[5]*4 - bin_value[6]*2) / 1;

    write_data(bin_value[0]+0x30);
    write_data(bin_value[1]+0x30);
    write_data(bin_value[2]+0x30);
    write_data(bin_value[3]+0x30);
    write_data(' ');
    write_data(bin_value[4]+0x30);
    write_data(bin_value[5]+0x30);
    write_data(bin_value[6]+0x30);
    write_data(bin_value[7]+0x30);

}

char Hex_convert(char a){
    if (a < 10) {
        return a + '0';
    }
    else {
        return a - 10 + 'A';
    }
}

void delay_m(unsigned int m){
    unsigned int i, j;
    for(i=0;i<m;i++){
        for(j=0;j<2100;j++){
            ;
        }
    }
}
